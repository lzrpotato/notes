<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/notes/favicon.ico"/><title>ORMs</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal Knowledge Space"/><meta property="og:title" content="ORMs"/><meta property="og:description" content="Personal Knowledge Space"/><meta property="og:url" content="https://zhiruiluo.github.io/notes/notes/qgh5ypgf2ed0blahec22bl7/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="11/10/2022"/><meta property="article:modified_time" content="11/10/2022"/><link rel="canonical" href="https://zhiruiluo.github.io/notes/notes/qgh5ypgf2ed0blahec22bl7/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/notes/_next/static/css/43ff47b87e0ea661.css" as="style"/><link rel="stylesheet" href="/notes/_next/static/css/43ff47b87e0ea661.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/notes/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/notes/_next/static/chunks/webpack-3c3caf24173c5c0a.js" defer=""></script><script src="/notes/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/notes/_next/static/chunks/main-5bb057769933cd70.js" defer=""></script><script src="/notes/_next/static/chunks/pages/_app-9ff413458d97c377.js" defer=""></script><script src="/notes/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/notes/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/notes/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/notes/_next/static/uUtIryXGCPFy--3F9KYMA/_buildManifest.js" defer=""></script><script src="/notes/_next/static/uUtIryXGCPFy--3F9KYMA/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="orms">ORMs<a aria-hidden="true" class="anchor-heading icon-link" href="#orms"></a></h1>
<h2 id="object-relational-mappers-orms">Object Relational Mappers (ORMs)<a aria-hidden="true" class="anchor-heading icon-link" href="#object-relational-mappers-orms"></a></h2>
<p>An object-relational mapper (ORM) is a code library that automates the transfer of data stored in relational database tables into objects that are more commonly used in application code.</p>
<h2 id="orm-tools-for-python">ORM Tools For Python<a aria-hidden="true" class="anchor-heading icon-link" href="#orm-tools-for-python"></a></h2>
<ol>
<li><a href="https://www.sqlalchemy.org/">SQLAlchemy</a></li>
<li><a href="http://docs.peewee-orm.com/en/latest/">Peewee</a></li>
<li><a href="https://docs.djangoproject.com/en/dev/topics/db/">The Django ORM</a></li>
<li><a href="https://ponyorm.org/">PonyORM</a></li>
<li><a href="http://sqlobject.org/">SQLObject</a></li>
<li><a href="https://tortoise-orm.readthedocs.io/en/latest/">Tortoise ORM</a></li>
</ol>
<p>ORMs @ Full Stack Python <a href="https://www.fullstackpython.com/object-relational-mappers-orms.html">link</a></p>
<h2 id="example-implementation">Example Implementation<a aria-hidden="true" class="anchor-heading icon-link" href="#example-implementation"></a></h2>
<p>To-do List App [<a href="https://hackernoon.com/building-a-to-do-list-app-with-python-data-access-layer-with-sqlalchemy">Rodolfo Campos, hackernoon.com, Oct. 15, 2021</a>]</p>
<p>The actual implementation has the following components:</p>
<ol>
<li>Schema. Defines the database schema and provides connections wrapped in a Transaction Manager that keeps the database conversational state.</li>
<li>BasRepo. Itâ€™s an abstract repository that implements the main 4 operations of a simple CRUD. Assuming that every table uses an auto-increment id field.</li>
<li>UserRepo and tests. Extends BaseRepo for Users.</li>
<li>TodRepo and tests. Extends BaseRepo for To-dos.</li>
</ol>
<h2 id="schema">Schema<a aria-hidden="true" class="anchor-heading icon-link" href="#schema"></a></h2>
<p>About the implementation:</p>
<ul>
<li>Uses an env variable for creating the engine</li>
<li>Defines the DB schema</li>
<li>Offers methods to create and drop the DB schema</li>
<li>Offers a Context Manager (TransactionManager) that wraps the connection and handles the DB conversational state. Easy to use with Python with statements.</li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> <span class="token punctuation">(</span>
    create_engine<span class="token punctuation">,</span> 
    Boolean<span class="token punctuation">,</span>
    Column<span class="token punctuation">,</span> 
    ForeignKey<span class="token punctuation">,</span>
    Integer<span class="token punctuation">,</span> 
    MetaData<span class="token punctuation">,</span> 
    String<span class="token punctuation">,</span>
    Table
<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Schema</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"DB_URI"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> echo<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> future<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> MetaData<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>tables <span class="token operator">=</span> self<span class="token punctuation">.</span>__generate_tables<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create_transaction</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> TransactionManager<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        

    <span class="token keyword">def</span> <span class="token function">create_all_tables</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span>self<span class="token punctuation">.</span>engine<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">drop_all_tables</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>drop_all<span class="token punctuation">(</span>self<span class="token punctuation">.</span>engine<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__generate_tables</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">'todo'</span><span class="token punctuation">:</span> Table<span class="token punctuation">(</span><span class="token string">'todo'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span> <span class="token punctuation">,</span> autoincrement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> ForeignKey<span class="token punctuation">(</span><span class="token string">'user.id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'description'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">,</span> Boolean<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'user'</span><span class="token punctuation">:</span> Table<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span> <span class="token punctuation">,</span> autoincrement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'fullname'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TransactionManager</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>schema <span class="token operator">=</span> schema
        self<span class="token punctuation">.</span>conn <span class="token operator">=</span> self<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre>
<h2 id="baserepo">BaseRepo<a aria-hidden="true" class="anchor-heading icon-link" href="#baserepo"></a></h2>
<p>About the implementation:</p>
<ul>
<li>Assumes that the table is defined in the schema and has an auto-increment id field.</li>
<li>Separates insert from update. You could implement just a save operation, similar to an upsert.</li>
<li>Returns cursors when finding all, not an array. Useful when handling several rows.</li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABC<span class="token punctuation">,</span> abstractmethod
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> insert<span class="token punctuation">,</span> select<span class="token punctuation">,</span> update
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>exc <span class="token keyword">import</span> InvalidRequestError

<span class="token keyword">class</span> <span class="token class-name">BaseRepo</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>conn <span class="token operator">=</span> tx<span class="token punctuation">.</span>conn
        self<span class="token punctuation">.</span>schema <span class="token operator">=</span> tx<span class="token punctuation">.</span>schema

    <span class="token keyword">def</span> <span class="token function">find_all</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_get_table<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">find_by_id</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        table <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_table<span class="token punctuation">(</span><span class="token punctuation">)</span>
        stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> <span class="token builtin">id</span><span class="token punctuation">)</span>
        res <span class="token operator">=</span> self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
        <span class="token keyword">if</span> res<span class="token punctuation">:</span>
            <span class="token keyword">return</span> res<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span>
        table <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_table<span class="token punctuation">(</span><span class="token punctuation">)</span>
        stmt <span class="token operator">=</span> insert<span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        res <span class="token operator">=</span> self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span>inserted_primary_key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span>
        prev_user <span class="token operator">=</span> self<span class="token punctuation">.</span>find_by_id<span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> prev_user<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> InvalidRequestError<span class="token punctuation">(</span><span class="token string">'Invalid id'</span><span class="token punctuation">)</span>
        stmt <span class="token operator">=</span> update<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_get_table<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">_get_table</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
</code></pre>
<h2 id="todorepo">TodoRepo<a aria-hidden="true" class="anchor-heading icon-link" href="#todorepo"></a></h2>
<p>About the implementation:</p>
<ul>
<li>Extends BaseRepo.</li>
<li>Implements the only required method that returns the corresponding table from the Schema.</li>
<li>Any specific data access methods should be implemented here.</li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> base_repo <span class="token keyword">import</span> BaseRepo

<span class="token keyword">class</span> <span class="token class-name">TodoRepo</span><span class="token punctuation">(</span>BaseRepo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">_get_table</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>tables<span class="token punctuation">[</span><span class="token string">'todo'</span><span class="token punctuation">]</span>
</code></pre>
<h2 id="todorepotest">TodoRepoTest<a aria-hidden="true" class="anchor-heading icon-link" href="#todorepotest"></a></h2>
<p>About the implementation:</p>
<ul>
<li>Uses in-memory sqlite DB, injected via env variables.</li>
<li>Groups in classes tests per each method in TodoRepo.</li>
<li>Creates a new schema per test.</li>
<li>Enables foreign constraints.</li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> pytest
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> event<span class="token punctuation">,</span> insert<span class="token punctuation">,</span> select
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>exc <span class="token keyword">import</span> IntegrityError<span class="token punctuation">,</span> InvalidRequestError

<span class="token keyword">from</span> schema <span class="token keyword">import</span> Schema
<span class="token keyword">from</span> todo_repo <span class="token keyword">import</span> TodoRepo

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">schema</span><span class="token punctuation">(</span>monkeypatch<span class="token punctuation">)</span><span class="token punctuation">:</span>
    monkeypatch<span class="token punctuation">.</span>setenv<span class="token punctuation">(</span><span class="token string">"DB_URI"</span><span class="token punctuation">,</span> <span class="token string">"sqlite://"</span><span class="token punctuation">)</span>
    schema <span class="token operator">=</span> Schema<span class="token punctuation">(</span><span class="token punctuation">)</span>
    _enable_foreign_constraints<span class="token punctuation">(</span>schema<span class="token punctuation">)</span>
    schema<span class="token punctuation">.</span>create_all_tables<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> schema

<span class="token keyword">def</span> <span class="token function">_enable_foreign_constraints</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">_fk_pragma_on_connect</span><span class="token punctuation">(</span>dbapi_con<span class="token punctuation">,</span> con_record<span class="token punctuation">)</span><span class="token punctuation">:</span>
        dbapi_con<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'pragma foreign_keys=ON'</span><span class="token punctuation">)</span>
    event<span class="token punctuation">.</span>listen<span class="token punctuation">(</span>schema<span class="token punctuation">.</span>engine<span class="token punctuation">,</span> <span class="token string">'connect'</span><span class="token punctuation">,</span> _fk_pragma_on_connect<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">TestTodoRepo_find_all</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_when_multiple_todos</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'a@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname a'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'todo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'todo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description b'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">False</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            todos <span class="token operator">=</span> TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'description a'</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'description b'</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">test_when_empty</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            todos <span class="token operator">=</span> TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>

<span class="token keyword">class</span> <span class="token class-name">TestTodoRepo_find_by_id</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_when_todo_exists</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'a@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname a'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'todo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'todo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description b'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">False</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            todo <span class="token operator">=</span> TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>find_by_id<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> todo<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todo<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todo<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'description a'</span>
            <span class="token keyword">assert</span> todo<span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">test_when_todo_does_not_exists</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            todo <span class="token operator">=</span> TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>find_by_id<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> todo <span class="token keyword">is</span> <span class="token boolean">None</span>

<span class="token keyword">class</span> <span class="token class-name">TestTodoRepo_insert</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_when_auto_increment_id</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'a@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname a'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token builtin">id</span> <span class="token operator">=</span> TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            table <span class="token operator">=</span> tx<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>tables<span class="token punctuation">[</span><span class="token string">'todo'</span><span class="token punctuation">]</span>
            todos <span class="token operator">=</span> tx<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>select<span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token builtin">id</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'description a'</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">test_when_set_id</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'a@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname a'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            table <span class="token operator">=</span> tx<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>tables<span class="token punctuation">[</span><span class="token string">'todo'</span><span class="token punctuation">]</span>
            todos <span class="token operator">=</span> tx<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>select<span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">99</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'description a'</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">test_when_invalid_id</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">,</span> pytest<span class="token punctuation">.</span>raises<span class="token punctuation">(</span>IntegrityError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'a@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname a'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'invalid'</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_when_invalid_user_id</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">,</span> pytest<span class="token punctuation">.</span>raises<span class="token punctuation">(</span>IntegrityError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_when_duplicated_id</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">,</span> pytest<span class="token punctuation">.</span>raises<span class="token punctuation">(</span>IntegrityError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            repo <span class="token operator">=</span> TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
            repo<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            repo<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">TestTodoRepo_update</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_when_todo_exists</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'a@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname a'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'b@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname b'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'todo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description b'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">False</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            table <span class="token operator">=</span> tx<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>tables<span class="token punctuation">[</span><span class="token string">'todo'</span><span class="token punctuation">]</span>
            todos <span class="token operator">=</span> tx<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>select<span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'description b'</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">test_when_todo_does_not_exists</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">,</span> pytest<span class="token punctuation">.</span>raises<span class="token punctuation">(</span>InvalidRequestError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description b'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">False</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">insert_obj</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> table_name<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
    table <span class="token operator">=</span> tx<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>tables<span class="token punctuation">[</span>table_name<span class="token punctuation">]</span>
    stmt <span class="token operator">=</span> insert<span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    tx<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
</code></pre>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/notes/notes/cij49qs329muip03oop0wcu">Database</a></li>
</ul></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#object-relational-mappers-orms" title="Object Relational Mappers (ORMs)">Object Relational Mappers (ORMs)</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#orm-tools-for-python" title="ORM Tools For Python">ORM Tools For Python</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#example-implementation" title="Example Implementation">Example Implementation</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#schema" title="Schema">Schema</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#baserepo" title="BaseRepo">BaseRepo</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#todorepo" title="TodoRepo">TodoRepo</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#todorepotest" title="TodoRepoTest">TodoRepoTest</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"qgh5ypgf2ed0blahec22bl7","title":"ORMs","desc":"","updated":1668100313380,"created":1668097443787,"custom":{},"fname":"database.orm","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"f7aedc3b253a12a71788ecb9d24ace8c","links":[{"from":{"fname":"database","id":"cij49qs329muip03oop0wcu","vaultName":"Dendron"},"type":"backlink","position":{"start":{"line":3,"column":29,"offset":52},"end":{"line":3,"column":45,"offset":68},"indent":[]},"value":"database.orm"}],"anchors":{"object-relational-mappers-orms":{"type":"header","text":"Object Relational Mappers (ORMs)","value":"object-relational-mappers-orms","line":8,"column":0,"depth":2},"orm-tools-for-python":{"type":"header","text":"ORM Tools For Python","value":"orm-tools-for-python","line":11,"column":0,"depth":2},"example-implementation":{"type":"header","text":"Example Implementation","value":"example-implementation","line":21,"column":0,"depth":2},"schema":{"type":"header","text":"Schema","value":"schema","line":30,"column":0,"depth":2},"baserepo":{"type":"header","text":"BaseRepo","value":"baserepo","line":95,"column":0,"depth":2},"todorepo":{"type":"header","text":"TodoRepo","value":"todorepo","line":141,"column":0,"depth":2},"todorepotest":{"type":"header","text":"TodoRepoTest","value":"todorepotest","line":157,"column":0,"depth":2}},"children":[],"parent":"cij49qs329muip03oop0wcu","data":{}},"body":"\u003ch1 id=\"orms\"\u003eORMs\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#orms\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"object-relational-mappers-orms\"\u003eObject Relational Mappers (ORMs)\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#object-relational-mappers-orms\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eAn object-relational mapper (ORM) is a code library that automates the transfer of data stored in relational database tables into objects that are more commonly used in application code.\u003c/p\u003e\n\u003ch2 id=\"orm-tools-for-python\"\u003eORM Tools For Python\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#orm-tools-for-python\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"https://www.sqlalchemy.org/\"\u003eSQLAlchemy\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://docs.peewee-orm.com/en/latest/\"\u003ePeewee\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.djangoproject.com/en/dev/topics/db/\"\u003eThe Django ORM\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://ponyorm.org/\"\u003ePonyORM\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://sqlobject.org/\"\u003eSQLObject\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://tortoise-orm.readthedocs.io/en/latest/\"\u003eTortoise ORM\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eORMs @ Full Stack Python \u003ca href=\"https://www.fullstackpython.com/object-relational-mappers-orms.html\"\u003elink\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"example-implementation\"\u003eExample Implementation\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#example-implementation\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eTo-do List App [\u003ca href=\"https://hackernoon.com/building-a-to-do-list-app-with-python-data-access-layer-with-sqlalchemy\"\u003eRodolfo Campos, hackernoon.com, Oct. 15, 2021\u003c/a\u003e]\u003c/p\u003e\n\u003cp\u003eThe actual implementation has the following components:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eSchema. Defines the database schema and provides connections wrapped in a Transaction Manager that keeps the database conversational state.\u003c/li\u003e\n\u003cli\u003eBasRepo. Itâ€™s an abstract repository that implements the main 4 operations of a simple CRUD. Assuming that every table uses an auto-increment id field.\u003c/li\u003e\n\u003cli\u003eUserRepo and tests. Extends BaseRepo for Users.\u003c/li\u003e\n\u003cli\u003eTodRepo and tests. Extends BaseRepo for To-dos.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"schema\"\u003eSchema\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#schema\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eAbout the implementation:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUses an env variable for creating the engine\u003c/li\u003e\n\u003cli\u003eDefines the DB schema\u003c/li\u003e\n\u003cli\u003eOffers methods to create and drop the DB schema\u003c/li\u003e\n\u003cli\u003eOffers a Context Manager (TransactionManager) that wraps the connection and handles the DB conversational state. Easy to use with Python with statements.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e os\n\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e sqlalchemy \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    create_engine\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \n    Boolean\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    Column\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \n    ForeignKey\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    Integer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \n    MetaData\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \n    String\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    Table\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSchema\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e__init__\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eengine \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e create_engine\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egetenv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"DB_URI\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e echo\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e future\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emetadata \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e MetaData\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etables \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e__generate_tables\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreate_transaction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e TransactionManager\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e        \n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreate_all_tables\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emetadata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_all\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eengine\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003edrop_all_tables\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emetadata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edrop_all\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eengine\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e__generate_tables\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'todo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e Table\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'todo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emetadata\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                Column\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Integer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e primary_key\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e autoincrement\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                Column\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Integer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ForeignKey\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'user.id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                Column\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e String\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e500\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                Column\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Boolean\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token string\"\u003e'user'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e Table\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'user'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emetadata\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                Column\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Integer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e primary_key\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e autoincrement\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                Column\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'email'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e String\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e50\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                Column\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'fullname'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e String\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e50\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eTransactionManager\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e__init__\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eschema \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e schema\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econn \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eschema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eengine\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econnect\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e__enter__\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e self\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e__exit__\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003etype\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e value\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e traceback\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econn\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecommit\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econn\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclose\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"baserepo\"\u003eBaseRepo\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#baserepo\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eAbout the implementation:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAssumes that the table is defined in the schema and has an auto-increment id field.\u003c/li\u003e\n\u003cli\u003eSeparates insert from update. You could implement just a save operation, similar to an upsert.\u003c/li\u003e\n\u003cli\u003eReturns cursors when finding all, not an array. Useful when handling several rows.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e abc \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e ABC\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e abstractmethod\n\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e sqlalchemy \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e insert\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e select\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e update\n\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e sqlalchemy\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexc \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e InvalidRequestError\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBaseRepo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eABC\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e__init__\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econn \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econn\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eschema \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eschema\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003efind_all\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        stmt \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e select\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e_get_table\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econn\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexecute\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estmt\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003efind_by_id\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        table \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e_get_table\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        stmt \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e select\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etable\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewhere\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etable\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ec\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eid\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eid\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        res \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econn\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexecute\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estmt\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efetchone\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003einsert\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e user\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        table \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e_get_table\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        stmt \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e insert\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etable\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003evalues\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        res \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econn\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexecute\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estmt\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einserted_primary_key\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eupdate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e user\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        prev_user \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efind_by_id\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enot\u003c/span\u003e prev_user\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eraise\u003c/span\u003e InvalidRequestError\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'Invalid id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        stmt \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e update\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e_get_table\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003evalues\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econn\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexecute\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estmt\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token decorator annotation punctuation\"\u003e@abstractmethod\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e_get_table\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003epass\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"todorepo\"\u003eTodoRepo\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#todorepo\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eAbout the implementation:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eExtends BaseRepo.\u003c/li\u003e\n\u003cli\u003eImplements the only required method that returns the corresponding table from the Schema.\u003c/li\u003e\n\u003cli\u003eAny specific data access methods should be implemented here.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e base_repo \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e BaseRepo\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eTodoRepo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eBaseRepo\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e_get_table\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eschema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etables\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'todo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"todorepotest\"\u003eTodoRepoTest\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#todorepotest\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eAbout the implementation:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUses in-memory sqlite DB, injected via env variables.\u003c/li\u003e\n\u003cli\u003eGroups in classes tests per each method in TodoRepo.\u003c/li\u003e\n\u003cli\u003eCreates a new schema per test.\u003c/li\u003e\n\u003cli\u003eEnables foreign constraints.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e pytest\n\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e sqlalchemy \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e event\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e insert\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e select\n\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e sqlalchemy\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexc \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e IntegrityError\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e InvalidRequestError\n\n\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e schema \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e Schema\n\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e todo_repo \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e TodoRepo\n\n\u003cspan class=\"token decorator annotation punctuation\"\u003e@pytest\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efixture\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eschema\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emonkeypatch\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    monkeypatch\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esetenv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"DB_URI\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"sqlite://\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    schema \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Schema\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    _enable_foreign_constraints\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eschema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    schema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_all_tables\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e schema\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e_enable_foreign_constraints\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eschema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e_fk_pragma_on_connect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edbapi_con\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e con_record\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        dbapi_con\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexecute\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'pragma foreign_keys=ON'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    event\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elisten\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eschema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eengine\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'connect'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e _fk_pragma_on_connect\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eTestTodoRepo_find_all\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003etest_when_multiple_todos\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_transaction\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            insert_obj\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'email'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'a@test.com'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname a'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            insert_obj\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'todo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description a'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            insert_obj\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'todo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description b'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eFalse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            todos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e TodoRepo\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efind_all\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efetchall\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e \u003cspan class=\"token builtin\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etodos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description a'\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description b'\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eFalse\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003etest_when_empty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_transaction\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            todos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e TodoRepo\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efind_all\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efetchall\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e \u003cspan class=\"token builtin\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etodos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eTestTodoRepo_find_by_id\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003etest_when_todo_exists\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_transaction\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            insert_obj\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'email'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'a@test.com'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname a'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            insert_obj\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'todo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description a'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            insert_obj\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'todo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description b'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eFalse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            todo \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e TodoRepo\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efind_by_id\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todo\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todo\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todo\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description a'\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todo\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003etest_when_todo_does_not_exists\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_transaction\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            todo \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e TodoRepo\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efind_by_id\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todo \u003cspan class=\"token keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eNone\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eTestTodoRepo_insert\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003etest_when_auto_increment_id\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_transaction\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            insert_obj\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'email'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'a@test.com'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname a'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token builtin\"\u003eid\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e TodoRepo\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einsert\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description a'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            table \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eschema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etables\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'todo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n            todos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econn\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexecute\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eselect\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etable\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efetchall\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e \u003cspan class=\"token builtin\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etodos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eid\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description a'\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003etest_when_set_id\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_transaction\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            insert_obj\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'email'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'a@test.com'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname a'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            TodoRepo\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einsert\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e99\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description a'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            table \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eschema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etables\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'todo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n            todos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econn\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexecute\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eselect\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etable\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efetchall\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e \u003cspan class=\"token builtin\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etodos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e99\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description a'\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003etest_when_invalid_id\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_transaction\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e pytest\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eraises\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eIntegrityError\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            insert_obj\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'email'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'a@test.com'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname a'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            TodoRepo\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einsert\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'invalid'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description a'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003etest_when_invalid_user_id\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_transaction\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e pytest\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eraises\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eIntegrityError\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            TodoRepo\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einsert\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description a'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003etest_when_duplicated_id\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_transaction\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e pytest\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eraises\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eIntegrityError\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            repo \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e TodoRepo\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            repo\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einsert\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description a'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            repo\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einsert\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description a'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eTestTodoRepo_update\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003etest_when_todo_exists\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_transaction\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            insert_obj\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'email'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'a@test.com'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname a'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            insert_obj\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'email'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'b@test.com'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'fullname b'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            insert_obj\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'todo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description a'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            TodoRepo\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description b'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eFalse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            table \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eschema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etables\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'todo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n            todos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econn\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexecute\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eselect\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etable\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efetchall\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e \u003cspan class=\"token builtin\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etodos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description b'\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e todos\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eFalse\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003etest_when_todo_does_not_exists\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e schema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_transaction\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e pytest\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eraises\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eInvalidRequestError\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            TodoRepo\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user_id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'description b'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'active'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eFalse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003einsert_obj\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etx\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e table_name\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e obj\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    table \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tx\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eschema\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etables\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003etable_name\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    stmt \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e insert\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etable\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003evalues\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eobj\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    tx\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econn\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexecute\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estmt\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003cstrong\u003eBacklinks\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/notes/notes/cij49qs329muip03oop0wcu\"\u003eDatabase\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","noteIndex":{"id":"root","title":"Zhirui Luo's Study Notes","desc":"","updated":1668118900608,"created":1595961348801,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"a69d5be4dfe784efed2a85af0b39b156","links":[{"type":"wiki","from":{"fname":"root","id":"root","vaultName":"Dendron"},"value":"leetcode","position":{"start":{"line":6,"column":3,"offset":70},"end":{"line":6,"column":15,"offset":82},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"leetcode"}},{"type":"wiki","from":{"fname":"root","id":"root","vaultName":"Dendron"},"value":"database","position":{"start":{"line":7,"column":3,"offset":85},"end":{"line":7,"column":15,"offset":97},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"database"}},{"type":"wiki","from":{"fname":"root","id":"root","vaultName":"Dendron"},"value":"designpattern","position":{"start":{"line":8,"column":3,"offset":100},"end":{"line":8,"column":20,"offset":117},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"designpattern"}}],"anchors":{"hi-there":{"type":"header","text":"Hi, there!","value":"hi-there","line":8,"column":0,"depth":1},"this-is-a-website-for-my-study-notes":{"type":"header","text":"This is a website for my study notes.","value":"this-is-a-website-for-my-study-notes","line":9,"column":0,"depth":2},"contents":{"type":"header","text":"Contents","value":"contents","line":11,"column":0,"depth":2}},"children":["cij49qs329muip03oop0wcu","ohshp0xxd5vn3edsgw59cjq","lupic2fhrxv5ory6kjlfu08"],"parent":null,"data":{},"body":"\n# Hi, there!\n## This is a website for my study notes.\n\n## Contents\n- [[leetcode]]\n- [[database]]\n- [[designpattern]]"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":".","selfContained":true,"name":"Dendron"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Zhirui Luo's Study Notes","description":"Personal Knowledge Space","author":"Zhirui Luo"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"search","assetsPrefix":"/notes","siteUrl":"https://zhiruiluo.github.io","ga":{"tracking":"G-VH64NJ4XGS"},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"qgh5ypgf2ed0blahec22bl7"},"buildId":"uUtIryXGCPFy--3F9KYMA","assetPrefix":"/notes","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>