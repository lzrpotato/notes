<h1 id="orms">ORMs<a aria-hidden="true" class="anchor-heading icon-link" href="#orms"></a></h1>
<h2 id="object-relational-mappers-orms">Object Relational Mappers (ORMs)<a aria-hidden="true" class="anchor-heading icon-link" href="#object-relational-mappers-orms"></a></h2>
<p>An object-relational mapper (ORM) is a code library that automates the transfer of data stored in relational database tables into objects that are more commonly used in application code.</p>
<h2 id="orm-tools-for-python">ORM Tools For Python<a aria-hidden="true" class="anchor-heading icon-link" href="#orm-tools-for-python"></a></h2>
<ol>
<li><a href="https://www.sqlalchemy.org/">SQLAlchemy</a></li>
<li><a href="http://docs.peewee-orm.com/en/latest/">Peewee</a></li>
<li><a href="https://docs.djangoproject.com/en/dev/topics/db/">The Django ORM</a></li>
<li><a href="https://ponyorm.org/">PonyORM</a></li>
<li><a href="http://sqlobject.org/">SQLObject</a></li>
<li><a href="https://tortoise-orm.readthedocs.io/en/latest/">Tortoise ORM</a></li>
</ol>
<p>ORMs @ Full Stack Python <a href="https://www.fullstackpython.com/object-relational-mappers-orms.html">link</a></p>
<h2 id="example-implementation">Example Implementation<a aria-hidden="true" class="anchor-heading icon-link" href="#example-implementation"></a></h2>
<p>To-do List App [<a href="https://hackernoon.com/building-a-to-do-list-app-with-python-data-access-layer-with-sqlalchemy">Rodolfo Campos, hackernoon.com, Oct. 15, 2021</a>]</p>
<p>The actual implementation has the following components:</p>
<ol>
<li>Schema. Defines the database schema and provides connections wrapped in a Transaction Manager that keeps the database conversational state.</li>
<li>BasRepo. Itâ€™s an abstract repository that implements the main 4 operations of a simple CRUD. Assuming that every table uses an auto-increment id field.</li>
<li>UserRepo and tests. Extends BaseRepo for Users.</li>
<li>TodRepo and tests. Extends BaseRepo for To-dos.</li>
</ol>
<h2 id="schema">Schema<a aria-hidden="true" class="anchor-heading icon-link" href="#schema"></a></h2>
<p>About the implementation:</p>
<ul>
<li>Uses an env variable for creating the engine</li>
<li>Defines the DB schema</li>
<li>Offers methods to create and drop the DB schema</li>
<li>Offers a Context Manager (TransactionManager) that wraps the connection and handles the DB conversational state. Easy to use with Python with statements.</li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> <span class="token punctuation">(</span>
    create_engine<span class="token punctuation">,</span> 
    Boolean<span class="token punctuation">,</span>
    Column<span class="token punctuation">,</span> 
    ForeignKey<span class="token punctuation">,</span>
    Integer<span class="token punctuation">,</span> 
    MetaData<span class="token punctuation">,</span> 
    String<span class="token punctuation">,</span>
    Table
<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Schema</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"DB_URI"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> echo<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> future<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> MetaData<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>tables <span class="token operator">=</span> self<span class="token punctuation">.</span>__generate_tables<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create_transaction</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> TransactionManager<span class="token punctuation">(</span>self<span class="token punctuation">)</span>        

    <span class="token keyword">def</span> <span class="token function">create_all_tables</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span>self<span class="token punctuation">.</span>engine<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">drop_all_tables</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>drop_all<span class="token punctuation">(</span>self<span class="token punctuation">.</span>engine<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__generate_tables</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">'todo'</span><span class="token punctuation">:</span> Table<span class="token punctuation">(</span><span class="token string">'todo'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span> <span class="token punctuation">,</span> autoincrement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> ForeignKey<span class="token punctuation">(</span><span class="token string">'user.id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'description'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">,</span> Boolean<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'user'</span><span class="token punctuation">:</span> Table<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span> <span class="token punctuation">,</span> autoincrement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Column<span class="token punctuation">(</span><span class="token string">'fullname'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TransactionManager</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>schema <span class="token operator">=</span> schema
        self<span class="token punctuation">.</span>conn <span class="token operator">=</span> self<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre>
<h2 id="baserepo">BaseRepo<a aria-hidden="true" class="anchor-heading icon-link" href="#baserepo"></a></h2>
<p>About the implementation:</p>
<ul>
<li>Assumes that the table is defined in the schema and has an auto-increment id field.</li>
<li>Separates insert from update. You could implement just a save operation, similar to an upsert.</li>
<li>Returns cursors when finding all, not an array. Useful when handling several rows.</li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> abc <span class="token keyword">import</span> ABC<span class="token punctuation">,</span> abstractmethod
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> insert<span class="token punctuation">,</span> select<span class="token punctuation">,</span> update
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>exc <span class="token keyword">import</span> InvalidRequestError

<span class="token keyword">class</span> <span class="token class-name">BaseRepo</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>conn <span class="token operator">=</span> tx<span class="token punctuation">.</span>conn
        self<span class="token punctuation">.</span>schema <span class="token operator">=</span> tx<span class="token punctuation">.</span>schema

    <span class="token keyword">def</span> <span class="token function">find_all</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_get_table<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">find_by_id</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        table <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_table<span class="token punctuation">(</span><span class="token punctuation">)</span>
        stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> <span class="token builtin">id</span><span class="token punctuation">)</span>
        res <span class="token operator">=</span> self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
        <span class="token keyword">if</span> res<span class="token punctuation">:</span>
            <span class="token keyword">return</span> res<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span>
        table <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_table<span class="token punctuation">(</span><span class="token punctuation">)</span>
        stmt <span class="token operator">=</span> insert<span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        res <span class="token operator">=</span> self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span>inserted_primary_key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span>
        prev_user <span class="token operator">=</span> self<span class="token punctuation">.</span>find_by_id<span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> prev_user<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> InvalidRequestError<span class="token punctuation">(</span><span class="token string">'Invalid id'</span><span class="token punctuation">)</span>
        stmt <span class="token operator">=</span> update<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_get_table<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">_get_table</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
</code></pre>
<h2 id="todorepo">TodoRepo<a aria-hidden="true" class="anchor-heading icon-link" href="#todorepo"></a></h2>
<p>About the implementation:</p>
<ul>
<li>Extends BaseRepo.</li>
<li>Implements the only required method that returns the corresponding table from the Schema.</li>
<li>Any specific data access methods should be implemented here.</li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> base_repo <span class="token keyword">import</span> BaseRepo

<span class="token keyword">class</span> <span class="token class-name">TodoRepo</span><span class="token punctuation">(</span>BaseRepo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">_get_table</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>tables<span class="token punctuation">[</span><span class="token string">'todo'</span><span class="token punctuation">]</span>
</code></pre>
<h2 id="todorepotest">TodoRepoTest<a aria-hidden="true" class="anchor-heading icon-link" href="#todorepotest"></a></h2>
<p>About the implementation:</p>
<ul>
<li>Uses in-memory sqlite DB, injected via env variables.</li>
<li>Groups in classes tests per each method in TodoRepo.</li>
<li>Creates a new schema per test.</li>
<li>Enables foreign constraints.</li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> pytest
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> event<span class="token punctuation">,</span> insert<span class="token punctuation">,</span> select
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>exc <span class="token keyword">import</span> IntegrityError<span class="token punctuation">,</span> InvalidRequestError

<span class="token keyword">from</span> schema <span class="token keyword">import</span> Schema
<span class="token keyword">from</span> todo_repo <span class="token keyword">import</span> TodoRepo

<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">schema</span><span class="token punctuation">(</span>monkeypatch<span class="token punctuation">)</span><span class="token punctuation">:</span>
    monkeypatch<span class="token punctuation">.</span>setenv<span class="token punctuation">(</span><span class="token string">"DB_URI"</span><span class="token punctuation">,</span> <span class="token string">"sqlite://"</span><span class="token punctuation">)</span>
    schema <span class="token operator">=</span> Schema<span class="token punctuation">(</span><span class="token punctuation">)</span>
    _enable_foreign_constraints<span class="token punctuation">(</span>schema<span class="token punctuation">)</span>
    schema<span class="token punctuation">.</span>create_all_tables<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> schema

<span class="token keyword">def</span> <span class="token function">_enable_foreign_constraints</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">_fk_pragma_on_connect</span><span class="token punctuation">(</span>dbapi_con<span class="token punctuation">,</span> con_record<span class="token punctuation">)</span><span class="token punctuation">:</span>
        dbapi_con<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'pragma foreign_keys=ON'</span><span class="token punctuation">)</span>
    event<span class="token punctuation">.</span>listen<span class="token punctuation">(</span>schema<span class="token punctuation">.</span>engine<span class="token punctuation">,</span> <span class="token string">'connect'</span><span class="token punctuation">,</span> _fk_pragma_on_connect<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">TestTodoRepo_find_all</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_when_multiple_todos</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'a@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname a'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'todo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'todo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description b'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">False</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            todos <span class="token operator">=</span> TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'description a'</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'description b'</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">test_when_empty</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            todos <span class="token operator">=</span> TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>

<span class="token keyword">class</span> <span class="token class-name">TestTodoRepo_find_by_id</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_when_todo_exists</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'a@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname a'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'todo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'todo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description b'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">False</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            todo <span class="token operator">=</span> TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>find_by_id<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> todo<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todo<span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todo<span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'description a'</span>
            <span class="token keyword">assert</span> todo<span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">test_when_todo_does_not_exists</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            todo <span class="token operator">=</span> TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>find_by_id<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> todo <span class="token keyword">is</span> <span class="token boolean">None</span>

<span class="token keyword">class</span> <span class="token class-name">TestTodoRepo_insert</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_when_auto_increment_id</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'a@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname a'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token builtin">id</span> <span class="token operator">=</span> TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            table <span class="token operator">=</span> tx<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>tables<span class="token punctuation">[</span><span class="token string">'todo'</span><span class="token punctuation">]</span>
            todos <span class="token operator">=</span> tx<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>select<span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token builtin">id</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'description a'</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">test_when_set_id</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'a@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname a'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            table <span class="token operator">=</span> tx<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>tables<span class="token punctuation">[</span><span class="token string">'todo'</span><span class="token punctuation">]</span>
            todos <span class="token operator">=</span> tx<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>select<span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">99</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'description a'</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">test_when_invalid_id</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">,</span> pytest<span class="token punctuation">.</span>raises<span class="token punctuation">(</span>IntegrityError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'a@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname a'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'invalid'</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_when_invalid_user_id</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">,</span> pytest<span class="token punctuation">.</span>raises<span class="token punctuation">(</span>IntegrityError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_when_duplicated_id</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">,</span> pytest<span class="token punctuation">.</span>raises<span class="token punctuation">(</span>IntegrityError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            repo <span class="token operator">=</span> TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
            repo<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            repo<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">TestTodoRepo_update</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_when_todo_exists</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">:</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'a@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname a'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'b@test.com'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'fullname b'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            insert_obj<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token string">'todo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description a'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description b'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">False</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            table <span class="token operator">=</span> tx<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>tables<span class="token punctuation">[</span><span class="token string">'todo'</span><span class="token punctuation">]</span>
            todos <span class="token operator">=</span> tx<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>select<span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'description b'</span>
            <span class="token keyword">assert</span> todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'active'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">test_when_todo_does_not_exists</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> schema<span class="token punctuation">.</span>create_transaction<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tx<span class="token punctuation">,</span> pytest<span class="token punctuation">.</span>raises<span class="token punctuation">(</span>InvalidRequestError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            TodoRepo<span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'description b'</span><span class="token punctuation">,</span> <span class="token string">'active'</span><span class="token punctuation">:</span> <span class="token boolean">False</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">insert_obj</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> table_name<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
    table <span class="token operator">=</span> tx<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>tables<span class="token punctuation">[</span>table_name<span class="token punctuation">]</span>
    stmt <span class="token operator">=</span> insert<span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    tx<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
</code></pre>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/notes/notes/cij49qs329muip03oop0wcu">Database</a></li>
</ul>